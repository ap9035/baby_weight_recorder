# å¬°å…’é«”é‡ç´€éŒ„ç³»çµ± - é–‹ç™¼æ™‚ç¨‹èˆ‡é€²åº¦

> å°ˆæ¡ˆé–‹ç™¼è¿½è¹¤æ–‡ä»¶

---

## å°ˆæ¡ˆè³‡è¨Š

- **å°ˆæ¡ˆåç¨±**ï¼šBaby Weight Recorder
- **é–‹å§‹æ—¥æœŸ**ï¼š2026-01-12
- **ç›®æ¨™ä¸Šç·šæ—¥æœŸ**ï¼š_å¾…å®š_
- **æŠ€è¡“è¦æ ¼æ›¸**ï¼š[baby_weight_recorder-spec.md](./baby_weight_recorder-spec.md)

---

## é–‹ç™¼éšæ®µç¸½è¦½

```mermaid
gantt
    title å¬°å…’é«”é‡ç´€éŒ„ç³»çµ±é–‹ç™¼æ™‚ç¨‹
    dateFormat  YYYY-MM-DD
    section éšæ®µä¸€ï¼šåŸºç¤å»ºè¨­
    å°ˆæ¡ˆåˆå§‹åŒ–           :done, p1, 2026-01-12, 1d
    Terraform è¨­å®š       :done, p2, after p1, 1d
    CI/CD Pipeline       :done, p3, after p2, 1d
    section éšæ®µäºŒï¼šWeight APIï¼ˆå„ªå…ˆï¼‰
    API åŸºç¤æ¶æ§‹         :active, w1, after p3, 1d
    Baby CRUD            :w2, after w1, 2d
    Weight CRUD          :w3, after w2, 2d
    æˆé•·æ›²ç·šè©•ä¼°         :w4, after w3, 3d
    section éšæ®µä¸‰ï¼šAuth Service
    Auth åŸºç¤æ¶æ§‹        :a1, after w4, 2d
    è¨»å†Š/ç™»å…¥ API        :a2, after a1, 2d
    JWT/JWKS å¯¦ä½œ        :a3, after a2, 2d
    section éšæ®µå››ï¼šæ•´åˆæ¸¬è©¦
    æ•´åˆæ¸¬è©¦             :t1, after a3, 3d
    ä¿®å¾©èˆ‡å„ªåŒ–           :t2, after t1, 2d
    section éšæ®µäº”ï¼šéƒ¨ç½²
    Dev ç’°å¢ƒéƒ¨ç½²         :d1, after t2, 1d
    Prod ç’°å¢ƒéƒ¨ç½²        :d2, after d1, 1d
```

---

## éšæ®µä¸€ï¼šåŸºç¤å»ºè¨­

### 1.1 å°ˆæ¡ˆåˆå§‹åŒ–

| ä»»å‹™ | ç‹€æ…‹ | é è¨ˆæ™‚é–“ | èªªæ˜ |
|------|------|----------|------|
| å»ºç«‹å°ˆæ¡ˆçµæ§‹ | âœ… å®Œæˆ | 0.5 å¤© | api/, auth/, tests/, terraform/ |
| è¨­å®š uv + pyproject.toml | âœ… å®Œæˆ | 0.5 å¤© | ä¾è³´ç®¡ç†ã€é–‹ç™¼å·¥å…·è¨­å®š |
| è¨­å®š Ruff + MyPy | âœ… å®Œæˆ | 0.5 å¤© | Linterã€Type Checker |
| å»ºç«‹ Dockerfile | âœ… å®Œæˆ | 0.5 å¤© | api/Dockerfile, auth/Dockerfile |

### 1.2 Terraform åŸºç¤å»ºè¨­

| ä»»å‹™ | ç‹€æ…‹ | é è¨ˆæ™‚é–“ | èªªæ˜ |
|------|------|----------|------|
| GCP Project è¨­å®š | âœ… å®Œæˆ | 0.5 å¤© | å•Ÿç”¨å¿…è¦ API |
| Artifact Registry | âœ… å®Œæˆ | 0.5 å¤© | Container Registry |
| Firestore è¨­å®š | âœ… å®Œæˆ | 0.5 å¤© | Database + Index |
| Secret Manager | âœ… å®Œæˆ | 0.5 å¤© | JWT Key ç­‰æ©Ÿæ•è³‡æ–™ |
| Cloud Run (Dev) | âœ… å®Œæˆ | 1 å¤© | Dev ç’°å¢ƒï¼ˆplaceholder imageï¼‰ |
| Kong Gateway | âœ… å®Œæˆ | 1 å¤© | Kong on Cloud Runï¼ˆæ›¿ä»£ GCP API Gatewayï¼‰ |
| Workload Identity | âœ… å®Œæˆ | 0.5 å¤© | GitHub Actions èªè­‰ |

> **Kong Gateway**ï¼šæ”¹ç”¨ Kong Gateway æ›¿ä»£ GCP API Gatewayï¼ŒåŸå› ï¼š
> - GCP API Gateway ä¸æ”¯æ´ asia-east1ï¼ˆå°ç£ï¼‰ï¼Œéœ€ç¹é“æ±äº¬å¢åŠ  60-100ms å»¶é²
> - Kong å¯éƒ¨ç½²åœ¨ Cloud Run asia-east1ï¼Œèˆ‡å…¶ä»–æœå‹™åŒå€åŸŸï¼Œé›¶é¡å¤–å»¶é²
> - Kong åŠŸèƒ½æ›´è±å¯Œï¼ˆRate Limitingã€CORSã€Logging ç­‰æ’ä»¶ï¼‰

### 1.3 CI/CD Pipeline

| ä»»å‹™ | ç‹€æ…‹ | é è¨ˆæ™‚é–“ | èªªæ˜ |
|------|------|----------|------|
| ci.yml | âœ… å®Œæˆ | 0.5 å¤© | Test + Lint + Docker Build |
| terraform-plan.yml | âœ… å®Œæˆ | 0.5 å¤© | PR æ™‚åŸ·è¡Œ planï¼ˆå« PR commentï¼‰ |
| deploy-dev.yml | âœ… å®Œæˆ | 1 å¤© | è‡ªå‹•éƒ¨ç½² Dev + Smoke Test |
| deploy-prod.yml | âœ… å®Œæˆ | 0.5 å¤© | æ‰‹å‹•éƒ¨ç½² Prodï¼ˆéœ€ç¢ºèªï¼‰ |

---

## éšæ®µäºŒï¼šWeight API Serviceï¼ˆå„ªå…ˆé–‹ç™¼ï¼‰

> ğŸ“Œ **å„ªå…ˆé–‹ç™¼ Weight API**ï¼Œå…ˆè®“æ ¸å¿ƒåŠŸèƒ½åœ¨æœ¬åœ°è·‘èµ·ä¾†ï¼ŒAuth æ•´åˆç¨å¾Œè™•ç†ã€‚

### 2.1 API åŸºç¤æ¶æ§‹

| ä»»å‹™ | ç‹€æ…‹ | é è¨ˆæ™‚é–“ | èªªæ˜ |
|------|------|----------|------|
| FastAPI æ‡‰ç”¨ç¨‹å¼æ¶æ§‹ | âœ… å®Œæˆ | 0.5 å¤© | main.py, routers/, models/ |
| InMemory Repository | âœ… å®Œæˆ | 0.5 å¤© | é–‹ç™¼/æ¸¬è©¦ç”¨ï¼Œé‡å•Ÿè³‡æ–™æ¶ˆå¤± |
| Firestore Repository | âœ… å®Œæˆ | 0.5 å¤© | ç”Ÿç”¢ç’°å¢ƒç”¨ï¼Œæ”¯æ´ Emulator |
| æœ¬åœ°é–‹ç™¼ç’°å¢ƒ | âœ… å®Œæˆ | 0.5 å¤© | uvicorn å•Ÿå‹•ã€ç†±é‡è¼‰ã€dev token |

### 2.2 Baby CRUD

| ä»»å‹™ | ç‹€æ…‹ | é è¨ˆæ™‚é–“ | èªªæ˜ |
|------|------|----------|------|
| POST /v1/babies | âœ… å®Œæˆ | 0.5 å¤© | å»ºç«‹å¬°å…’ |
| GET /v1/babies | âœ… å®Œæˆ | 0.5 å¤© | åˆ—å‡ºå¬°å…’ |
| GET /v1/babies/{id} | âœ… å®Œæˆ | 0.5 å¤© | å–å¾—å–®ä¸€å¬°å…’ |
| PUT /v1/babies/{id} | âœ… å®Œæˆ | 0.5 å¤© | æ›´æ–°å¬°å…’ |
| DELETE /v1/babies/{id} | âœ… å®Œæˆ | 0.5 å¤© | åˆªé™¤å¬°å…’ |
| Membership æ¬Šé™æª¢æŸ¥ | âœ… å®Œæˆ | 0.5 å¤© | owner/editor/viewerï¼ˆdev tokenï¼‰ |
| å–®å…ƒæ¸¬è©¦ | âœ… å®Œæˆ | 1 å¤© | pytestï¼ˆ13 testsï¼‰ |

### 2.3 Weight CRUD

| ä»»å‹™ | ç‹€æ…‹ | é è¨ˆæ™‚é–“ | èªªæ˜ |
|------|------|----------|------|
| POST /v1/babies/{id}/weights | âœ… å®Œæˆ | 0.5 å¤© | æ–°å¢é«”é‡ |
| GET /v1/babies/{id}/weights | âœ… å®Œæˆ | 0.5 å¤© | æŸ¥è©¢é«”é‡ï¼ˆå«æ™‚é–“ç¯„åœç¯©é¸ï¼‰ |
| GET /v1/babies/{id}/weights/{wid} | âœ… å®Œæˆ | 0.5 å¤© | å–å¾—å–®ä¸€é«”é‡ |
| PUT /v1/babies/{id}/weights/{wid} | âœ… å®Œæˆ | 0.5 å¤© | ä¿®æ”¹é«”é‡ |
| DELETE /v1/babies/{id}/weights/{wid} | âœ… å®Œæˆ | 0.5 å¤© | åˆªé™¤é«”é‡ |
| å–®å…ƒæ¸¬è©¦ | âœ… å®Œæˆ | 1 å¤© | pytestï¼ˆ14 testsï¼‰ |

### 2.4 æˆé•·æ›²ç·šè©•ä¼°

| ä»»å‹™ | ç‹€æ…‹ | é è¨ˆæ™‚é–“ | èªªæ˜ |
|------|------|----------|------|
| WHO æˆé•·æ•¸æ“šæ•´åˆ | âœ… å®Œæˆ | 1 å¤© | ç”·/å¥³ç«¥ 0-60 æœˆï¼ˆ0-5 æ­²ï¼‰LMS åƒæ•¸ |
| ç™¾åˆ†ä½è¨ˆç®—é‚è¼¯ | âœ… å®Œæˆ | 1 å¤© | Z-Scoreã€Percentile |
| GET .../weights/{wid}/assessment | âœ… å®Œæˆ | 0.5 å¤© | å®Œæ•´è©•ä¼° API |
| includeAssessment åƒæ•¸ | âœ… å®Œæˆ | 0.5 å¤© | åˆ—è¡¨æ‰¹æ¬¡è©•ä¼° |
| å–®å…ƒæ¸¬è©¦ | âœ… å®Œæˆ | 1 å¤© | 8 tests passed |

---

## éšæ®µä¸‰ï¼šAuth Service

### 3.1 Auth åŸºç¤æ¶æ§‹

| ä»»å‹™ | ç‹€æ…‹ | é è¨ˆæ™‚é–“ | èªªæ˜ |
|------|------|----------|------|
| FastAPI æ‡‰ç”¨ç¨‹å¼æ¶æ§‹ | â¬œ å¾…é–‹å§‹ | 0.5 å¤© | main.py, routers/ |
| Firestore Repository | â¬œ å¾…é–‹å§‹ | 1 å¤© | User è³‡æ–™å­˜å– |
| å¯†ç¢¼é›œæ¹Šï¼ˆbcryptï¼‰ | â¬œ å¾…é–‹å§‹ | 0.5 å¤© | passlib æ•´åˆ |

### 3.2 è¨»å†Š/ç™»å…¥ API

| ä»»å‹™ | ç‹€æ…‹ | é è¨ˆæ™‚é–“ | èªªæ˜ |
|------|------|----------|------|
| POST /auth/register | â¬œ å¾…é–‹å§‹ | 1 å¤© | å«é‚€è«‹ç¢¼é©—è­‰ |
| POST /auth/token | â¬œ å¾…é–‹å§‹ | 1 å¤© | ç™»å…¥å–å¾— JWT |
| å–®å…ƒæ¸¬è©¦ | â¬œ å¾…é–‹å§‹ | 1 å¤© | pytest |

### 3.3 JWT/JWKS å¯¦ä½œ

| ä»»å‹™ | ç‹€æ…‹ | é è¨ˆæ™‚é–“ | èªªæ˜ |
|------|------|----------|------|
| RSA Key ç®¡ç† | â¬œ å¾…é–‹å§‹ | 0.5 å¤© | ç”¢ç”Ÿ/è®€å–é‡‘é‘° |
| JWT ç°½ç™¼ | â¬œ å¾…é–‹å§‹ | 0.5 å¤© | python-jose |
| GET /.well-known/jwks.json | â¬œ å¾…é–‹å§‹ | 0.5 å¤© | å…¬é‘° Endpoint |
| å–®å…ƒæ¸¬è©¦ | â¬œ å¾…é–‹å§‹ | 0.5 å¤© | JWT é©—è­‰æ¸¬è©¦ |

### 3.4 Weight API æ•´åˆ

| ä»»å‹™ | ç‹€æ…‹ | é è¨ˆæ™‚é–“ | èªªæ˜ |
|------|------|----------|------|
| JWT é©—è­‰ Middleware | â¬œ å¾…é–‹å§‹ | 0.5 å¤© | JWKS é©—è­‰ |
| Identity Link è§£æ | â¬œ å¾…é–‹å§‹ | 0.5 å¤© | iss+sub â†’ internalUserId |
| ç§»é™¤ Mock User | â¬œ å¾…é–‹å§‹ | 0.5 å¤© | æ”¹ç”¨çœŸå¯¦èªè­‰ |

---

## éšæ®µå››ï¼šæ•´åˆæ¸¬è©¦

| ä»»å‹™ | ç‹€æ…‹ | é è¨ˆæ™‚é–“ | èªªæ˜ |
|------|------|----------|------|
| æœ¬åœ° E2E æ¸¬è©¦ | â¬œ å¾…é–‹å§‹ | 1 å¤© | Firestore Emulator + Kong Docker |
| Auth â†’ API æ•´åˆæ¸¬è©¦ | â¬œ å¾…é–‹å§‹ | 1 å¤© | å®Œæ•´èªè­‰æµç¨‹ |
| Kong Gateway æ¸¬è©¦ | â¬œ å¾…é–‹å§‹ | 1 å¤© | æœ¬åœ° Docker + Cloud Run |
| æ•ˆèƒ½æ¸¬è©¦ï¼ˆåŸºæœ¬ï¼‰ | â¬œ å¾…é–‹å§‹ | 0.5 å¤© | åŸºæœ¬è² è¼‰æ¸¬è©¦ |
| Bug ä¿®å¾© | â¬œ å¾…é–‹å§‹ | 2 å¤© | é ç•™æ™‚é–“ |

---

## éšæ®µäº”ï¼šéƒ¨ç½²

| ä»»å‹™ | ç‹€æ…‹ | é è¨ˆæ™‚é–“ | èªªæ˜ |
|------|------|----------|------|
| Dev ç’°å¢ƒéƒ¨ç½² | â¬œ å¾…é–‹å§‹ | 0.5 å¤© | terraform apply |
| Dev ç’°å¢ƒé©—è­‰ | â¬œ å¾…é–‹å§‹ | 0.5 å¤© | Smoke Test |
| Prod ç’°å¢ƒéƒ¨ç½² | â¬œ å¾…é–‹å§‹ | 0.5 å¤© | terraform apply |
| Prod ç’°å¢ƒé©—è­‰ | â¬œ å¾…é–‹å§‹ | 0.5 å¤© | Smoke Test |
| æ–‡ä»¶æ›´æ–° | â¬œ å¾…é–‹å§‹ | 0.5 å¤© | READMEã€éƒ¨ç½²æ–‡ä»¶ |

---

## é€²åº¦è¿½è¹¤

### çµ±è¨ˆ

| éšæ®µ | ç¸½ä»»å‹™ | å®Œæˆ | é€²è¡Œä¸­ | å¾…é–‹å§‹ |
|------|--------|------|--------|--------|
| éšæ®µä¸€ï¼šåŸºç¤å»ºè¨­ | 15 | 15 | 0 | 0 |
| éšæ®µäºŒï¼šWeight API | 21 | 21 | 0 | 0 |
| éšæ®µä¸‰ï¼šAuth Service | 13 | 0 | 0 | 13 |
| éšæ®µå››ï¼šæ•´åˆæ¸¬è©¦ | 5 | 0 | 0 | 5 |
| éšæ®µäº”ï¼šéƒ¨ç½² | 5 | 0 | 0 | 5 |
| **ç¸½è¨ˆ** | **59** | **36** | **0** | **23** |

> ğŸ§ª **å–®å…ƒæ¸¬è©¦çµ±è¨ˆ**: 41 tests passed (Baby 13 + Weight 14 + Assessment 8 + Health 6)

### é ä¼°å·¥æ™‚

| éšæ®µ | é ä¼°å¤©æ•¸ |
|------|----------|
| éšæ®µä¸€ï¼šåŸºç¤å»ºè¨­ | 5 å¤© |
| éšæ®µäºŒï¼šWeight API | 8 å¤© |
| éšæ®µä¸‰ï¼šAuth Service | 8 å¤© |
| éšæ®µå››ï¼šæ•´åˆæ¸¬è©¦ | 5 å¤© |
| éšæ®µäº”ï¼šéƒ¨ç½² | 2 å¤© |
| **ç¸½è¨ˆ** | **28 å¤©** |

---

## é¢¨éšªèˆ‡æ³¨æ„äº‹é …

| é¢¨éšª | å½±éŸ¿ | ç·©è§£æªæ–½ |
|------|------|----------|
| WHO æˆé•·æ•¸æ“šæ ¼å¼è¤‡é›œ | ä¸­ | âœ… å·²è§£æ±ºï¼Œä½¿ç”¨ WHO LMS åƒæ•¸ |
| Kong Gateway è¨­å®š | ä½ | ä½¿ç”¨ DB-less modeï¼Œè¨­å®šç°¡å–® |
| Workload Identity è¨­å®š | ä½ | å·²æœ‰ç¶“é©—ï¼Œé¢¨éšªè¼ƒä½ |
| ç¬¬ä¸€æ¬¡ä½¿ç”¨ uv | ä½ | å·¥å…·æˆç†Ÿåº¦é«˜ |

---

## æ›´æ–°ç´€éŒ„

| æ—¥æœŸ | æ›´æ–°å…§å®¹ |
|------|----------|
| 2026-01-12 | åˆç‰ˆå»ºç«‹ |
| 2026-01-12 | å®Œæˆ 1.1 å°ˆæ¡ˆåˆå§‹åŒ–ï¼ˆå°ˆæ¡ˆçµæ§‹ã€pyproject.tomlã€Ruff/MyPyã€Dockerfileï¼‰ |
| 2026-01-12 | å®Œæˆ 1.2 Terraform åŸºç¤å»ºè¨­ï¼ˆ6/7 æ¨¡çµ„ï¼‰ï¼ŒAPI Gateway æš«ç·©ï¼ˆGCP éƒ¨ç½²æ™‚é–“éé•·ï¼‰ |
| 2026-01-12 | å®Œæˆ 1.3 CI/CD Pipelineï¼ˆci.ymlã€terraform-plan.ymlã€deploy-dev.ymlã€deploy-prod.ymlï¼‰ |
| 2026-01-12 | èª¿æ•´é–‹ç™¼é †åºï¼šéšæ®µäºŒæ”¹ç‚º Weight APIï¼ˆå„ªå…ˆæœ¬åœ°é–‹ç™¼ï¼‰ï¼Œéšæ®µä¸‰æ”¹ç‚º Auth Service |
| 2026-01-12 | å®Œæˆ 2.1 API åŸºç¤æ¶æ§‹ã€2.2 Baby CRUDã€2.3 Weight CRUDï¼ˆæœ¬åœ° In-Memory æ¨¡å¼ï¼‰ |
| 2026-01-12 | å®Œæˆ Firestore Repository å¯¦ä½œï¼Œæ”¯æ´ Emulator å’ŒçœŸå¯¦ GCP Firestore |
| 2026-01-12 | å®Œæˆ Baby/Weight CRUD å–®å…ƒæ¸¬è©¦ï¼ˆ27 tests passedï¼‰ |
| 2026-01-13 | å®Œæˆæˆé•·æ›²ç·šè©•ä¼°åŠŸèƒ½ï¼ˆWHO æ•¸æ“šã€AssessmentServiceã€APIã€8 testsï¼‰ |
| 2026-01-13 | æ“´å±• WHO æ•¸æ“šè‡³ 0-60 å€‹æœˆï¼ˆ0-5 æ­²ï¼‰ï¼Œç¸½æ¸¬è©¦æ•¸ 41 passed |
| 2026-01-14 | æ”¹ç”¨ Kong Gateway æ›¿ä»£ GCP API Gatewayï¼ˆasia-east1 æ”¯æ´ã€ä½å»¶é²ï¼‰ |
| 2026-01-14 | å®Œæˆ Kong Gateway éƒ¨ç½²ï¼ˆCloud Run + GitHub Actions CI/CDï¼‰ |

## ç•¶å‰ç’°å¢ƒè³‡è¨Š

### Cloud Run URLsï¼ˆDev ç’°å¢ƒï¼‰

| æœå‹™ | URL | å­˜å–æ¬Šé™ |
|------|-----|----------|
| **Kong Gateway** | https://kong-gateway-dev-ggofz32qfa-de.a.run.app | å…¬é–‹ï¼ˆAPI å…¥å£ï¼‰ |
| Auth Service | https://auth-service-dev-ggofz32qfa-de.a.run.app | å…¬é–‹ï¼ˆé€é Kongï¼‰ |
| Weight API | https://weight-api-dev-ggofz32qfa-de.a.run.app | éœ€èªè­‰ï¼ˆé€é Kongï¼‰ |

### å…¶ä»–è³‡æº

- **Artifact Registry**: `asia-east1-docker.pkg.dev/babyweightrecorder/baby-weight-dev`
- **Firestore Database**: `baby-weight-dev`
- **Workload Identity Provider**: `projects/750410344862/locations/global/workloadIdentityPools/github-pool-dev/providers/github-provider`
- **GitHub Actions SA**: `github-actions-dev@babyweightrecorder.iam.gserviceaccount.com`

---

**å‚™è¨»**ï¼š
- ç‹€æ…‹åœ–ç¤ºï¼šâ¬œ å¾…é–‹å§‹ | ğŸ”„ é€²è¡Œä¸­ | âœ… å®Œæˆ | âŒ å–æ¶ˆ
- é ä¼°æ™‚é–“ä»¥ 1 äººå…¨è·é–‹ç™¼è¨ˆç®—
- å¯¦éš›é€²åº¦å¯èƒ½å› éœ€æ±‚è®Šæ›´è€Œèª¿æ•´
